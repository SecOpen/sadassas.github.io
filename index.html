<script>
    const searchInput = document.getElementById('searchInput');
    const postsContainer = document.getElementById('posts-container');

    let postsData = [];

    async function loadPostsData() {
        try {
            const res = await fetch('posts.json');
            postsData = await res.json();

            // Перемешиваем посты для рандома
            for (let i = postsData.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [postsData[i], postsData[j]] = [postsData[j], postsData[i]];
            }

            displayPosts(postsData);
        } catch {
            postsContainer.innerHTML = '<p>Ошибка загрузки постов.</p>';
        }
    }

    function displayPosts(posts) {
        postsContainer.innerHTML = '';
        for (const post of posts) {
            const div = document.createElement('div');
            div.className = 'post';
            div.innerHTML = `<img src="${post.image}" alt="Пост"><p>${post.text}</p>`;
            postsContainer.appendChild(div);
        }
    }

    function onSearchInput() {
        const query = searchInput.value.trim().toLowerCase();
        if (query === '') {
            displayPosts(postsData);
            return;
        }

        const filtered = postsData.filter(post => post.text.toLowerCase().includes(query));
        if (filtered.length === 0) {
            postsContainer.innerHTML = '<p>Ничего не найдено.</p>';
        } else {
            displayPosts(filtered);
        }
    }

    searchInput.addEventListener('input', onSearchInput);

    loadPostsData();
</script>
