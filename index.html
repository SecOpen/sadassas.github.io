<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>гой baze</title>
<style>
  :root {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --accent-color: #00bcd4;
    --card-bg: #1e1e1e;
    --shadow: rgba(0, 0, 0, 0.4);
  }
  * {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: var(--bg-color);
    color: var(--text-color);
    font-family: 'Segoe UI', sans-serif;
    padding: 40px;
  }
  h1 {
    text-align: center;
    color: var(--accent-color);
    margin-bottom: 30px;
  }
  #posts-container {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  .post {
    background: var(--card-bg);
    padding: 15px;
    border-radius: 10px;
    width: 300px;
    box-shadow: 0 0 10px var(--shadow);
    cursor: default;
    text-align: center;
  }
  .post-title {
    font-size: 1.1em;
    margin-bottom: 10px;
  }
  button.read-btn {
    background: var(--accent-color);
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
  }
  button.read-btn:hover {
    background: #0097a7;
  }

  /* Модальное окно */
  #overlay {
    display: none;
    position: fixed;
    top:0; left:0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.7);
    z-index: 1000;
  }
  #modal {
    display: none;
    position: fixed;
    top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    width: 90vw;
    height: 80vh;
    background: var(--card-bg);
    border-radius: 15px;
    box-shadow: 0 0 20px var(--shadow);
    z-index: 1001;
    padding: 10px;
    color: var(--text-color);
    text-align: center;
    display: flex;
    flex-direction: column;
  }
  #modal iframe {
    flex-grow: 1;
    border-radius: 10px;
    border: none;
    background: white;
  }
  #modal .modal-footer {
    margin-top: 10px;
    display: flex;
    justify-content: space-between;
  }
  #modal button {
    background: var(--accent-color);
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    font-weight: bold;
    transition: background 0.3s ease;
  }
  #modal button:hover {
    background: #0097a7;
  }
  #modal .warning-text {
    color: #ff6666;
    margin-top: 5px;
  }
</style>
</head>
<body>

<h1>гой baze</h1>

<div id="posts-container"></div>

<div id="overlay"></div>

<div id="modal">
  <iframe id="postFrame" src="" allowfullscreen></iframe>
  <div class="warning-text" id="iframeWarning" style="display:none;">
    Внимание: сайт может быть заблокирован или не загружаться корректно.
  </div>
  <div class="modal-footer">
    <button id="open-new-tab">Открыть в новой вкладке</button>
    <button id="modal-close">Закрыть</button>
  </div>
</div>

<script>
  const postsContainer = document.getElementById('posts-container');
  const overlay = document.getElementById('overlay');
  const modal = document.getElementById('modal');
  const postFrame = document.getElementById('postFrame');
  const iframeWarning = document.getElementById('iframeWarning');
  const openNewTabBtn = document.getElementById('open-new-tab');
  const modalCloseBtn = document.getElementById('modal-close');

  let currentUrl = '';

  function openModal(url) {
    currentUrl = url;
    postFrame.src = url;
    iframeWarning.style.display = 'none';
    overlay.style.display = 'block';
    modal.style.display = 'flex';

    // Через 3 секунды показываем предупреждение, если iframe не загрузился
    setTimeout(() => {
      // Проверим, загрузился ли iframe - к сожалению, проверить напрямую нельзя из-за CORS
      // Значит просто показываем предупреждение всегда, чтобы пользователь не удивлялся
      iframeWarning.style.display = 'block';
    }, 3000);
  }

  function closeModal() {
    overlay.style.display = 'none';
    modal.style.display = 'none';
    postFrame.src = '';
    iframeWarning.style.display = 'none';
    currentUrl = '';
  }

  openNewTabBtn.addEventListener('click', () => {
    if(currentUrl) window.open(currentUrl, '_blank', 'noopener');
  });

  modalCloseBtn.addEventListener('click', closeModal);
  overlay.addEventListener('click', closeModal);

  function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
  }

  fetch('posts.json')
    .then(res => res.json())
    .then(data => {
      const posts = Object.entries(data).map(([id, url]) => ({id, url}));
      shuffle(posts);

      for (const post of posts) {
        const div = document.createElement('div');
        div.className = 'post';
        div.innerHTML = `
          <div class="post-title">Пост №${post.id}</div>
          <button class="read-btn">Читать</button>
        `;
        div.querySelector('button.read-btn').addEventListener('click', () => openModal(post.url));
        postsContainer.appendChild(div);
      }
    })
    .catch(() => {
      postsContainer.innerHTML = '<p>Ошибка загрузки постов.</p>';
    });
</script>

</body>
</html>
